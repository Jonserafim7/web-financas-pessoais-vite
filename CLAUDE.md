# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

```bash
npm run dev              # Start dev server (http://0.0.0.0:5173)
npm run build            # Type-check and build for production
npm run lint             # Run ESLint
npm run preview          # Preview production build
npm run generate:api     # Generate API client from OpenAPI spec
```

## Architecture

### Tech Stack
- **React 19** with TypeScript
- **TanStack Router** for file-based routing with route protection
- **TanStack Query** for server state management
- **TanStack Form** for form state with Zod validation
- **Better Auth** for cookie-based authentication
- **Axios** for HTTP client with interceptors
- **Orval** to generate TypeScript API client from OpenAPI
- **Tailwind CSS v4** with Radix UI primitives
- **Vite** as build tool with React Compiler enabled

### Project Structure

```
src/
├── features/           # Feature-based modules
│   ├── auth/          # Authentication (Better Auth integration)
│   │   ├── components/
│   │   ├── hooks/     # React Query hooks (useSession, useSignIn, etc.)
│   │   └── query-keys.ts
│   └── transactions/  # Transaction management
│       └── components/
│           └── form/  # Form components with TanStack Form
├── routes/            # File-based routing (TanStack Router)
│   ├── __root.tsx
│   ├── _auth/         # Public auth routes
│   └── _protected/    # Protected routes (require session)
├── components/
│   └── ui/            # Reusable Radix UI components
├── lib/
│   ├── generated/     # Auto-generated by Orval (DO NOT EDIT)
│   │   ├── api/       # API functions by tags
│   │   └── models/    # TypeScript types from OpenAPI
│   ├── auth-client.ts # Better Auth client config
│   ├── api-client.ts  # Axios instance with interceptors
│   ├── query-client.ts
│   └── utils.ts
└── main.tsx
```

### Authentication Flow
- Uses **Better Auth** with cookie-based sessions
- Auth client configured with `basePath: "/auth"` and `credentials: "include"`
- Session loaded via `useSession()` hook before router initialization
- Protected routes use `_protected` layout that redirects to `/sign-in` if no session
- Axios interceptor redirects to `/login` on 401 responses

### API Client Generation
- Run `npm run generate:api` to regenerate API client from backend OpenAPI spec
- Backend must be running at `http://localhost:3000`
- Orval generates React Query hooks in `src/lib/generated/api/`
- Custom Axios instance in `src/lib/api-client.ts` handles auth cookies and error handling
- All generated files use custom mutator for consistent error handling

### Routing Patterns
- File-based routing in `src/routes/`
- `_auth` prefix for public authentication routes
- `_protected` prefix for routes requiring authentication
- Route context includes `queryClient` and `session`
- Protected route guard checks session from query cache via `authKeys.session`

### Form Handling
- TanStack Form with Zod validation via `validators.onBlur`
- Form schemas use generated types from `src/lib/generated/models/`
- Forms submit with `form.handleSubmit()` and pass values to mutation hooks
- Field validation displays errors on blur with `field.state.meta.isTouched`

### Development Server
- Vite dev server runs on `0.0.0.0:5173` (for Docker compatibility)
- Proxy configured: `/api` → `http://api:3000` (Docker service name)
- For local dev without Docker, update proxy target to `http://localhost:3000`

### Path Aliases
- `@/*` resolves to `src/*` (configured in tsconfig and vite.config)

### DevTools
- TanStack Devtools enabled with Query, Router, and Form panels
- React Compiler enabled (impacts dev/build performance)
